// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: pages.sql

package store

import (
	"context"
	"database/sql"
	"time"
)

const countPageVersions = `-- name: CountPageVersions :one
SELECT COUNT(*) FROM page_versions WHERE page_id = ?
`

func (q *Queries) CountPageVersions(ctx context.Context, pageID int64) (int64, error) {
	row := q.db.QueryRowContext(ctx, countPageVersions, pageID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countPages = `-- name: CountPages :one
SELECT COUNT(*) FROM pages
`

func (q *Queries) CountPages(ctx context.Context) (int64, error) {
	row := q.db.QueryRowContext(ctx, countPages)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countPagesByStatus = `-- name: CountPagesByStatus :one
SELECT COUNT(*) FROM pages WHERE status = ?
`

func (q *Queries) CountPagesByStatus(ctx context.Context, status string) (int64, error) {
	row := q.db.QueryRowContext(ctx, countPagesByStatus, status)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createPage = `-- name: CreatePage :one
INSERT INTO pages (title, slug, body, status, author_id, created_at, updated_at)
VALUES (?, ?, ?, ?, ?, ?, ?)
RETURNING id, title, slug, body, status, author_id, created_at, updated_at, published_at
`

type CreatePageParams struct {
	Title     string    `json:"title"`
	Slug      string    `json:"slug"`
	Body      string    `json:"body"`
	Status    string    `json:"status"`
	AuthorID  int64     `json:"author_id"`
	CreatedAt time.Time `json:"created_at"`
	UpdatedAt time.Time `json:"updated_at"`
}

func (q *Queries) CreatePage(ctx context.Context, arg CreatePageParams) (Page, error) {
	row := q.db.QueryRowContext(ctx, createPage,
		arg.Title,
		arg.Slug,
		arg.Body,
		arg.Status,
		arg.AuthorID,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}

const createPageVersion = `-- name: CreatePageVersion :one

INSERT INTO page_versions (page_id, title, body, changed_by, created_at)
VALUES (?, ?, ?, ?, ?)
RETURNING id, page_id, title, body, changed_by, created_at
`

type CreatePageVersionParams struct {
	PageID    int64     `json:"page_id"`
	Title     string    `json:"title"`
	Body      string    `json:"body"`
	ChangedBy int64     `json:"changed_by"`
	CreatedAt time.Time `json:"created_at"`
}

// Page Version queries
func (q *Queries) CreatePageVersion(ctx context.Context, arg CreatePageVersionParams) (PageVersion, error) {
	row := q.db.QueryRowContext(ctx, createPageVersion,
		arg.PageID,
		arg.Title,
		arg.Body,
		arg.ChangedBy,
		arg.CreatedAt,
	)
	var i PageVersion
	err := row.Scan(
		&i.ID,
		&i.PageID,
		&i.Title,
		&i.Body,
		&i.ChangedBy,
		&i.CreatedAt,
	)
	return i, err
}

const deletePage = `-- name: DeletePage :exec
DELETE FROM pages WHERE id = ?
`

func (q *Queries) DeletePage(ctx context.Context, id int64) error {
	_, err := q.db.ExecContext(ctx, deletePage, id)
	return err
}

const deletePageVersions = `-- name: DeletePageVersions :exec
DELETE FROM page_versions WHERE page_id = ?
`

func (q *Queries) DeletePageVersions(ctx context.Context, pageID int64) error {
	_, err := q.db.ExecContext(ctx, deletePageVersions, pageID)
	return err
}

const getLatestPageVersion = `-- name: GetLatestPageVersion :one
SELECT id, page_id, title, body, changed_by, created_at FROM page_versions WHERE page_id = ? ORDER BY created_at DESC LIMIT 1
`

func (q *Queries) GetLatestPageVersion(ctx context.Context, pageID int64) (PageVersion, error) {
	row := q.db.QueryRowContext(ctx, getLatestPageVersion, pageID)
	var i PageVersion
	err := row.Scan(
		&i.ID,
		&i.PageID,
		&i.Title,
		&i.Body,
		&i.ChangedBy,
		&i.CreatedAt,
	)
	return i, err
}

const getPageByID = `-- name: GetPageByID :one
SELECT id, title, slug, body, status, author_id, created_at, updated_at, published_at FROM pages WHERE id = ?
`

func (q *Queries) GetPageByID(ctx context.Context, id int64) (Page, error) {
	row := q.db.QueryRowContext(ctx, getPageByID, id)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}

const getPageBySlug = `-- name: GetPageBySlug :one
SELECT id, title, slug, body, status, author_id, created_at, updated_at, published_at FROM pages WHERE slug = ?
`

func (q *Queries) GetPageBySlug(ctx context.Context, slug string) (Page, error) {
	row := q.db.QueryRowContext(ctx, getPageBySlug, slug)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}

const getPageVersion = `-- name: GetPageVersion :one
SELECT id, page_id, title, body, changed_by, created_at FROM page_versions WHERE id = ?
`

func (q *Queries) GetPageVersion(ctx context.Context, id int64) (PageVersion, error) {
	row := q.db.QueryRowContext(ctx, getPageVersion, id)
	var i PageVersion
	err := row.Scan(
		&i.ID,
		&i.PageID,
		&i.Title,
		&i.Body,
		&i.ChangedBy,
		&i.CreatedAt,
	)
	return i, err
}

const listPageVersions = `-- name: ListPageVersions :many
SELECT id, page_id, title, body, changed_by, created_at FROM page_versions WHERE page_id = ? ORDER BY created_at DESC LIMIT ? OFFSET ?
`

type ListPageVersionsParams struct {
	PageID int64 `json:"page_id"`
	Limit  int64 `json:"limit"`
	Offset int64 `json:"offset"`
}

func (q *Queries) ListPageVersions(ctx context.Context, arg ListPageVersionsParams) ([]PageVersion, error) {
	rows, err := q.db.QueryContext(ctx, listPageVersions, arg.PageID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []PageVersion{}
	for rows.Next() {
		var i PageVersion
		if err := rows.Scan(
			&i.ID,
			&i.PageID,
			&i.Title,
			&i.Body,
			&i.ChangedBy,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPages = `-- name: ListPages :many
SELECT id, title, slug, body, status, author_id, created_at, updated_at, published_at FROM pages ORDER BY created_at DESC LIMIT ? OFFSET ?
`

type ListPagesParams struct {
	Limit  int64 `json:"limit"`
	Offset int64 `json:"offset"`
}

func (q *Queries) ListPages(ctx context.Context, arg ListPagesParams) ([]Page, error) {
	rows, err := q.db.QueryContext(ctx, listPages, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Page{}
	for rows.Next() {
		var i Page
		if err := rows.Scan(
			&i.ID,
			&i.Title,
			&i.Slug,
			&i.Body,
			&i.Status,
			&i.AuthorID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.PublishedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPagesByStatus = `-- name: ListPagesByStatus :many
SELECT id, title, slug, body, status, author_id, created_at, updated_at, published_at FROM pages WHERE status = ? ORDER BY created_at DESC LIMIT ? OFFSET ?
`

type ListPagesByStatusParams struct {
	Status string `json:"status"`
	Limit  int64  `json:"limit"`
	Offset int64  `json:"offset"`
}

func (q *Queries) ListPagesByStatus(ctx context.Context, arg ListPagesByStatusParams) ([]Page, error) {
	rows, err := q.db.QueryContext(ctx, listPagesByStatus, arg.Status, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Page{}
	for rows.Next() {
		var i Page
		if err := rows.Scan(
			&i.ID,
			&i.Title,
			&i.Slug,
			&i.Body,
			&i.Status,
			&i.AuthorID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.PublishedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const publishPage = `-- name: PublishPage :one
UPDATE pages
SET status = 'published', published_at = ?, updated_at = ?
WHERE id = ?
RETURNING id, title, slug, body, status, author_id, created_at, updated_at, published_at
`

type PublishPageParams struct {
	PublishedAt sql.NullTime `json:"published_at"`
	UpdatedAt   time.Time    `json:"updated_at"`
	ID          int64        `json:"id"`
}

func (q *Queries) PublishPage(ctx context.Context, arg PublishPageParams) (Page, error) {
	row := q.db.QueryRowContext(ctx, publishPage, arg.PublishedAt, arg.UpdatedAt, arg.ID)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}

const slugExists = `-- name: SlugExists :one
SELECT EXISTS(SELECT 1 FROM pages WHERE slug = ?)
`

func (q *Queries) SlugExists(ctx context.Context, slug string) (int64, error) {
	row := q.db.QueryRowContext(ctx, slugExists, slug)
	var column_1 int64
	err := row.Scan(&column_1)
	return column_1, err
}

const slugExistsExcluding = `-- name: SlugExistsExcluding :one
SELECT EXISTS(SELECT 1 FROM pages WHERE slug = ? AND id != ?)
`

type SlugExistsExcludingParams struct {
	Slug string `json:"slug"`
	ID   int64  `json:"id"`
}

func (q *Queries) SlugExistsExcluding(ctx context.Context, arg SlugExistsExcludingParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, slugExistsExcluding, arg.Slug, arg.ID)
	var column_1 int64
	err := row.Scan(&column_1)
	return column_1, err
}

const unpublishPage = `-- name: UnpublishPage :one
UPDATE pages
SET status = 'draft', published_at = NULL, updated_at = ?
WHERE id = ?
RETURNING id, title, slug, body, status, author_id, created_at, updated_at, published_at
`

type UnpublishPageParams struct {
	UpdatedAt time.Time `json:"updated_at"`
	ID        int64     `json:"id"`
}

func (q *Queries) UnpublishPage(ctx context.Context, arg UnpublishPageParams) (Page, error) {
	row := q.db.QueryRowContext(ctx, unpublishPage, arg.UpdatedAt, arg.ID)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}

const updatePage = `-- name: UpdatePage :one
UPDATE pages
SET title = ?, slug = ?, body = ?, status = ?, updated_at = ?
WHERE id = ?
RETURNING id, title, slug, body, status, author_id, created_at, updated_at, published_at
`

type UpdatePageParams struct {
	Title     string    `json:"title"`
	Slug      string    `json:"slug"`
	Body      string    `json:"body"`
	Status    string    `json:"status"`
	UpdatedAt time.Time `json:"updated_at"`
	ID        int64     `json:"id"`
}

func (q *Queries) UpdatePage(ctx context.Context, arg UpdatePageParams) (Page, error) {
	row := q.db.QueryRowContext(ctx, updatePage,
		arg.Title,
		arg.Slug,
		arg.Body,
		arg.Status,
		arg.UpdatedAt,
		arg.ID,
	)
	var i Page
	err := row.Scan(
		&i.ID,
		&i.Title,
		&i.Slug,
		&i.Body,
		&i.Status,
		&i.AuthorID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.PublishedAt,
	)
	return i, err
}
