{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{T .AdminLang "scheduler.task_runs"}}</h1>
        <p class="page-description">{{.Data.Task.Name}} â€” <code>{{.Data.Task.Url}}</code></p>
    </div>
    <div class="page-actions">
        <a href="/admin/scheduler" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            {{T .AdminLang "scheduler.back_to_scheduler"}}
        </a>
        {{if not (isDemoMode)}}
        <form method="POST" action="/admin/scheduler/tasks/{{.Data.Task.ID}}/trigger" class="d-inline">
            {{.CSRFField}}
            <button type="submit" class="btn btn-primary" onclick="return confirm('{{T .AdminLang "scheduler.task_trigger_confirm"}}')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                {{T .AdminLang "scheduler.trigger_now"}}
            </button>
        </form>
        {{end}}
    </div>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-body">
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem;">
            <div>
                <small class="text-muted">{{T .AdminLang "scheduler.task_schedule"}}</small>
                <div><code>{{.Data.Task.Schedule}}</code></div>
            </div>
            <div>
                <small class="text-muted">{{T .AdminLang "scheduler.task_timeout"}}</small>
                <div>{{.Data.Task.TimeoutSeconds}}s</div>
            </div>
            <div>
                <small class="text-muted">{{T .AdminLang "label.status"}}</small>
                <div>
                    {{if eq .Data.Task.IsActive 1}}
                    <span class="badge badge-success">{{T .AdminLang "scheduler.task_active"}}</span>
                    {{else}}
                    <span class="badge badge-secondary">{{T .AdminLang "scheduler.task_inactive"}}</span>
                    {{end}}
                </div>
            </div>
            <div>
                <small class="text-muted">{{T .AdminLang "scheduler.total_runs"}}</small>
                <div>{{.Data.TotalCount}}</div>
            </div>
        </div>
    </div>
</div>

{{if .Data.Runs}}
<div class="card">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>{{T .AdminLang "scheduler.run_status"}}</th>
                    <th>{{T .AdminLang "scheduler.run_code"}}</th>
                    <th>{{T .AdminLang "scheduler.run_duration"}}</th>
                    <th>{{T .AdminLang "scheduler.run_started"}}</th>
                    <th>{{T .AdminLang "scheduler.run_error"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .Data.Runs}}
                <tr>
                    <td>
                        {{if eq .Status "success"}}
                        <span class="badge badge-success">{{T $.AdminLang "scheduler.status_success"}}</span>
                        {{else if eq .Status "failed"}}
                        <span class="badge badge-danger">{{T $.AdminLang "scheduler.status_failed"}}</span>
                        {{else}}
                        <span class="badge badge-warning">{{T $.AdminLang "scheduler.status_pending"}}</span>
                        {{end}}
                    </td>
                    <td>
                        {{if .StatusCode.Valid}}
                        <span class="{{if and (ge .StatusCode.Int64 200) (lt .StatusCode.Int64 300)}}text-success{{else}}text-danger{{end}}">
                            {{.StatusCode.Int64}}
                        </span>
                        {{else}}
                        <span class="text-muted">-</span>
                        {{end}}
                    </td>
                    <td>
                        {{if .DurationMs.Valid}}
                        {{.DurationMs.Int64}}ms
                        {{else}}
                        <span class="text-muted">-</span>
                        {{end}}
                    </td>
                    <td>
                        <small>{{formatDateTime .StartedAt}}</small>
                    </td>
                    <td>
                        {{if and .ErrorMessage.Valid .ErrorMessage.String}}
                        <small class="text-danger" title="{{.ErrorMessage.String}}">{{truncate .ErrorMessage.String 60}}</small>
                        {{else}}
                        <span class="text-muted">-</span>
                        {{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{if gt .Data.Pagination.TotalPages 1}}
    <div class="card-footer">
        {{template "pagination" (dict "Pagination" .Data.Pagination "AdminLang" .AdminLang)}}
    </div>
    {{end}}
</div>
{{else}}
<div class="card">
    <div class="card-body">
        <p class="text-muted">{{T .AdminLang "scheduler.no_runs"}}</p>
    </div>
</div>
{{end}}
{{end}}
