{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{if .Data.IsEdit}}{{T .AdminLang "redirects.edit"}}{{else}}{{T .AdminLang "redirects.new"}}{{end}}</h1>
        <p class="page-description">{{if .Data.IsEdit}}{{T .AdminLang "redirects.edit_description"}}{{else}}{{T .AdminLang "redirects.new_description"}}{{end}}</p>
    </div>
    <div class="page-actions">
        <a href="/admin/redirects" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            {{T .AdminLang "redirects.back_to_list"}}
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Data.IsEdit}}/admin/redirects/{{.Data.Redirect.ID}}{{else}}/admin/redirects{{end}}" class="form">
            {{.CSRFField}}
            {{if .Data.IsEdit}}
            <input type="hidden" name="_method" value="PUT">
            {{end}}

            <div class="form-row">
                <div class="form-group form-group-lg">
                    <label for="source_path" class="form-label">{{T .AdminLang "redirects.source_path"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="source_path"
                        name="source_path"
                        class="form-input{{if index .Data.Errors "source_path"}} is-invalid{{end}}"
                        value="{{if .Data.IsEdit}}{{.Data.Redirect.SourcePath}}{{else}}{{index .Data.FormValues "source_path"}}{{end}}"
                        placeholder="/old-page"
                        required
                        autofocus
                        maxlength="2048"
                    >
                    {{if index .Data.Errors "source_path"}}
                    <span class="form-error">{{index .Data.Errors "source_path"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "redirects.source_path_hint"}}</span>
                    {{end}}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group form-group-lg">
                    <label for="target_url" class="form-label">{{T .AdminLang "redirects.target_url"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="target_url"
                        name="target_url"
                        class="form-input{{if index .Data.Errors "target_url"}} is-invalid{{end}}"
                        value="{{if .Data.IsEdit}}{{.Data.Redirect.TargetUrl}}{{else}}{{index .Data.FormValues "target_url"}}{{end}}"
                        placeholder="/new-page or https://example.com/page"
                        required
                        maxlength="2048"
                    >
                    {{if index .Data.Errors "target_url"}}
                    <span class="form-error">{{index .Data.Errors "target_url"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "redirects.target_url_hint"}}</span>
                    {{end}}
                </div>
            </div>

            <div class="form-row form-row-2">
                <div class="form-group">
                    <label for="status_code" class="form-label">{{T .AdminLang "redirects.status_code"}} <span class="required">*</span></label>
                    <select
                        id="status_code"
                        name="status_code"
                        class="form-select{{if index .Data.Errors "status_code"}} is-invalid{{end}}"
                        required
                    >
                        {{$currentCode := ""}}
                        {{if .Data.IsEdit}}
                            {{$currentCode = printf "%d" .Data.Redirect.StatusCode}}
                        {{else}}
                            {{$currentCode = index .Data.FormValues "status_code"}}
                        {{end}}
                        {{range .Data.StatusCodes}}
                        <option value="{{.Code}}" {{if eq (printf "%d" .Code) $currentCode}}selected{{end}}>{{.Label}}</option>
                        {{end}}
                    </select>
                    {{if index .Data.Errors "status_code"}}
                    <span class="form-error">{{index .Data.Errors "status_code"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "redirects.status_code_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="target_type" class="form-label">{{T .AdminLang "redirects.target_type"}}</label>
                    <select
                        id="target_type"
                        name="target_type"
                        class="form-select{{if index .Data.Errors "target_type"}} is-invalid{{end}}"
                    >
                        {{$currentTarget := ""}}
                        {{if .Data.IsEdit}}
                            {{$currentTarget = .Data.Redirect.TargetType}}
                        {{else}}
                            {{$currentTarget = index .Data.FormValues "target_type"}}
                        {{end}}
                        {{range .Data.TargetTypes}}
                        <option value="{{.}}" {{if eq . $currentTarget}}selected{{end}}>{{.}}</option>
                        {{end}}
                    </select>
                    {{if index .Data.Errors "target_type"}}
                    <span class="form-error">{{index .Data.Errors "target_type"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "redirects.target_type_hint"}}</span>
                    {{end}}
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_wildcard" value="true"
                        {{if .Data.IsEdit}}{{if .Data.Redirect.IsWildcard}}checked{{end}}{{else}}{{if eq (index .Data.FormValues "is_wildcard") "true"}}checked{{end}}{{end}}>
                    <span class="checkbox-text">
                        <strong>{{T .AdminLang "redirects.is_wildcard"}}</strong>
                        <small>{{T .AdminLang "redirects.is_wildcard_hint"}}</small>
                    </span>
                </label>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="enabled" value="true"
                        {{if .Data.IsEdit}}{{if .Data.Redirect.Enabled}}checked{{end}}{{else}}{{if or (not (index .Data.FormValues "enabled")) (eq (index .Data.FormValues "enabled") "true")}}checked{{end}}{{end}}>
                    <span class="checkbox-text">
                        <strong>{{T .AdminLang "redirects.enabled"}}</strong>
                        <small>{{T .AdminLang "redirects.enabled_hint"}}</small>
                    </span>
                </label>
            </div>

            {{if .Data.IsEdit}}
            <div class="form-group">
                <label class="form-label">{{T .AdminLang "label.info"}}</label>
                <div class="info-box">
                    <div class="info-row">
                        <span class="info-label">{{T .AdminLang "label.created"}}:</span>
                        <span>{{formatDateTime .Data.Redirect.CreatedAt}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">{{T .AdminLang "label.updated"}}:</span>
                        <span>{{formatDateTime .Data.Redirect.UpdatedAt}}</span>
                    </div>
                </div>
            </div>
            {{end}}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    {{if .Data.IsEdit}}{{T .AdminLang "redirects.update"}}{{else}}{{T .AdminLang "redirects.create"}}{{end}}
                </button>
                <a href="/admin/redirects" class="btn btn-outline">{{T .AdminLang "btn.cancel"}}</a>
            </div>
        </form>
    </div>
</div>

<!-- Help Section -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">{{T .AdminLang "redirects.help_title"}}</h3>
    </div>
    <div class="card-body">
        <div class="help-section">
            <h4>{{T .AdminLang "redirects.help_wildcards_title"}}</h4>
            <p>{{T .AdminLang "redirects.help_wildcards_desc"}}</p>
            <ul class="help-list">
                <li><code>/old-blog/*</code> {{T .AdminLang "redirects.help_wildcard_example1"}}</li>
                <li><code>/products/*/details</code> {{T .AdminLang "redirects.help_wildcard_example2"}}</li>
            </ul>
        </div>
        <div class="help-section">
            <h4>{{T .AdminLang "redirects.help_status_codes_title"}}</h4>
            <ul class="help-list">
                <li><strong>301</strong> - {{T .AdminLang "redirects.help_301"}}</li>
                <li><strong>302</strong> - {{T .AdminLang "redirects.help_302"}}</li>
                <li><strong>307</strong> - {{T .AdminLang "redirects.help_307"}}</li>
                <li><strong>308</strong> - {{T .AdminLang "redirects.help_308"}}</li>
            </ul>
        </div>
        <div class="help-section">
            <h4>{{T .AdminLang "redirects.help_target_types_title"}}</h4>
            <ul class="help-list">
                <li><strong>_self</strong> - {{T .AdminLang "redirects.help_target_self"}}</li>
                <li><strong>_blank</strong> - {{T .AdminLang "redirects.help_target_blank"}}</li>
            </ul>
        </div>
    </div>
</div>
{{end}}
