{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{if .Data.IsEdit}}Edit User{{else}}New User{{end}}</h1>
        <p class="page-description">{{if .Data.IsEdit}}Update user information{{else}}Create a new CMS user{{end}}</p>
    </div>
    <div class="page-actions">
        <a href="/admin/users" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Back to Users
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Data.IsEdit}}/admin/users/{{.Data.User.ID}}{{else}}/admin/users{{end}}" class="form">
            {{if .Data.IsEdit}}
            <input type="hidden" name="_method" value="PUT">
            {{end}}

            <div class="form-grid">
                <div class="form-group">
                    <label for="name" class="form-label">Name <span class="required">*</span></label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        class="form-input{{if index .Data.Errors "name"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "name"}}"
                        placeholder="Enter full name"
                        required
                        autofocus
                    >
                    {{if index .Data.Errors "name"}}
                    <span class="form-error">{{index .Data.Errors "name"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email <span class="required">*</span></label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input{{if index .Data.Errors "email"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "email"}}"
                        placeholder="user@example.com"
                        required
                    >
                    {{if index .Data.Errors "email"}}
                    <span class="form-error">{{index .Data.Errors "email"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="role" class="form-label">Role <span class="required">*</span></label>
                    <select
                        id="role"
                        name="role"
                        class="form-input form-select{{if index .Data.Errors "role"}} is-invalid{{end}}"
                        required
                    >
                        <option value="">Select a role</option>
                        {{$currentRole := index .Data.FormValues "role"}}
                        {{range .Data.Roles}}
                        <option value="{{.}}"{{if eq . $currentRole}} selected{{end}}>
                            {{if eq . "admin"}}Admin - Full access{{else if eq . "editor"}}Editor - Content management{{else}}Viewer - Read only{{end}}
                        </option>
                        {{end}}
                    </select>
                    {{if index .Data.Errors "role"}}
                    <span class="form-error">{{index .Data.Errors "role"}}</span>
                    {{end}}
                </div>

                <div class="form-group form-group-full">
                    <hr class="form-divider">
                    <h3 class="form-section-title">{{if .Data.IsEdit}}Change Password{{else}}Password{{end}}</h3>
                    {{if .Data.IsEdit}}
                    <p class="form-help">Leave blank to keep the current password.</p>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Password{{if not .Data.IsEdit}} <span class="required">*</span>{{end}}</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input{{if index .Data.Errors "password"}} is-invalid{{end}}"
                        placeholder="{{if .Data.IsEdit}}New password{{else}}Enter password{{end}}"
                        minlength="8"
                        {{if not .Data.IsEdit}}required{{end}}
                    >
                    {{if index .Data.Errors "password"}}
                    <span class="form-error">{{index .Data.Errors "password"}}</span>
                    {{else}}
                    <span class="form-hint">Minimum 8 characters</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="password_confirm" class="form-label">Confirm Password{{if not .Data.IsEdit}} <span class="required">*</span>{{end}}</label>
                    <input
                        type="password"
                        id="password_confirm"
                        name="password_confirm"
                        class="form-input{{if index .Data.Errors "password_confirm"}} is-invalid{{end}}"
                        placeholder="Confirm password"
                        minlength="8"
                        {{if not .Data.IsEdit}}required{{end}}
                    >
                    {{if index .Data.Errors "password_confirm"}}
                    <span class="form-error">{{index .Data.Errors "password_confirm"}}</span>
                    {{end}}
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    {{if .Data.IsEdit}}Update User{{else}}Create User{{end}}
                </button>
                <a href="/admin/users" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>
{{end}}
