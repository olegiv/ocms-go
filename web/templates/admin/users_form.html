{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{if .Data.IsEdit}}{{T .AdminLang "users.edit"}}{{else}}{{T .AdminLang "users.new"}}{{end}}</h1>
        <p class="page-description">{{if .Data.IsEdit}}{{T .AdminLang "users.edit_description"}}{{else}}{{T .AdminLang "users.new_description"}}{{end}}</p>
    </div>
    <div class="page-actions">
        <a href="/admin/users" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            {{T .AdminLang "users.back_to_users"}}
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Data.IsEdit}}/admin/users/{{.Data.User.ID}}{{else}}/admin/users{{end}}" class="form">
            {{.CSRFField}}
            {{if .Data.IsEdit}}
            <input type="hidden" name="_method" value="PUT">
            {{end}}

            <div class="form-grid">
                <div class="form-group">
                    <label for="name" class="form-label">{{T .AdminLang "label.name"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        class="form-input{{if index .Data.Errors "name"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "name"}}"
                        placeholder="{{T .AdminLang "users.name_placeholder"}}"
                        required
                        autofocus
                        maxlength="255"
                    >
                    {{if index .Data.Errors "name"}}
                    <span class="form-error">{{index .Data.Errors "name"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">{{T .AdminLang "label.email"}} <span class="required">*</span></label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input{{if index .Data.Errors "email"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "email"}}"
                        placeholder="{{T .AdminLang "users.email_placeholder"}}"
                        required
                        maxlength="255"
                    >
                    {{if index .Data.Errors "email"}}
                    <span class="form-error">{{index .Data.Errors "email"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="role" class="form-label">{{T .AdminLang "label.role"}} <span class="required">*</span></label>
                    <select
                        id="role"
                        name="role"
                        class="form-input form-select{{if index .Data.Errors "role"}} is-invalid{{end}}"
                        required
                    >
                        <option value="">{{T .AdminLang "users.select_role"}}</option>
                        {{$currentRole := index .Data.FormValues "role"}}
                        {{$adminLang := .AdminLang}}
                        {{range .Data.Roles}}
                        <option value="{{.}}"{{if eq . $currentRole}} selected{{end}}>
                            {{if eq . "admin"}}{{T $adminLang "users.role_admin"}}{{else if eq . "editor"}}{{T $adminLang "users.role_editor"}}{{else}}{{T $adminLang "users.role_public"}}{{end}}
                        </option>
                        {{end}}
                    </select>
                    {{if index .Data.Errors "role"}}
                    <span class="form-error">{{index .Data.Errors "role"}}</span>
                    {{end}}
                </div>

                <div class="form-group form-group-full">
                    <hr class="form-divider">
                    <h3 class="form-section-title">{{if .Data.IsEdit}}{{T .AdminLang "users.change_password"}}{{else}}{{T .AdminLang "users.password_section"}}{{end}}</h3>
                    {{if .Data.IsEdit}}
                    <p class="form-help">{{T .AdminLang "users.password_keep_hint"}}</p>
                    {{end}}
                </div>

                <div class="form-group" x-data="passwordStrength()">
                    <label for="password" class="form-label">{{T .AdminLang "label.password"}}{{if not .Data.IsEdit}} <span class="required">*</span>{{end}}</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input{{if index .Data.Errors "password"}} is-invalid{{end}}"
                        placeholder="{{if .Data.IsEdit}}{{T .AdminLang "users.new_password_placeholder"}}{{else}}{{T .AdminLang "users.password_placeholder"}}{{end}}"
                        minlength="12"
                        {{if not .Data.IsEdit}}required{{end}}
                        x-model="password"
                        @input="checkStrength()"
                    >
                    <div class="password-strength" x-show="password.length > 0">
                        <div class="password-strength-bar">
                            <div class="password-strength-fill" :class="strengthClass" :style="'width: ' + strengthPercent + '%'"></div>
                        </div>
                        <span class="password-strength-text" :class="strengthClass" x-text="strengthText"></span>
                    </div>
                    {{if index .Data.Errors "password"}}
                    <span class="form-error">{{index .Data.Errors "password"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "users.password_min_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="password_confirm" class="form-label">{{T .AdminLang "label.confirm_password"}}{{if not .Data.IsEdit}} <span class="required">*</span>{{end}}</label>
                    <input
                        type="password"
                        id="password_confirm"
                        name="password_confirm"
                        class="form-input{{if index .Data.Errors "password_confirm"}} is-invalid{{end}}"
                        placeholder="{{T .AdminLang "users.confirm_password_placeholder"}}"
                        minlength="12"
                        {{if not .Data.IsEdit}}required{{end}}
                    >
                    {{if index .Data.Errors "password_confirm"}}
                    <span class="form-error">{{index .Data.Errors "password_confirm"}}</span>
                    {{end}}
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    {{if .Data.IsEdit}}{{T .AdminLang "users.update"}}{{else}}{{T .AdminLang "users.create"}}{{end}}
                </button>
                <a href="/admin/users" class="btn btn-outline">{{T .AdminLang "btn.cancel"}}</a>
            </div>
        </form>
    </div>
</div>
{{end}}
