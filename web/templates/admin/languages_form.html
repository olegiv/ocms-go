{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{if .Data.IsEdit}}{{T .AdminLang "languages.edit_language"}}{{else}}{{T .AdminLang "languages.new_language"}}{{end}}</h1>
        <p class="page-description">{{if .Data.IsEdit}}{{T .AdminLang "languages.update_settings"}}{{else}}{{T .AdminLang "languages.add_new"}}{{end}}</p>
    </div>
    <div class="page-actions">
        <a href="/admin/languages" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            {{T .AdminLang "languages.back_to_languages"}}
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{if .Data.IsEdit}}/admin/languages/{{.Data.Language.ID}}{{else}}/admin/languages{{end}}" class="form" x-data="languageForm()">
            {{.CSRFField}}
            {{if .Data.IsEdit}}
            <input type="hidden" name="_method" value="PUT">
            {{end}}

            <div class="form-grid">
                {{if not .Data.IsEdit}}
                <div class="form-group form-group-full">
                    <label class="form-label">{{T .AdminLang "languages.quick_select"}}</label>
                    <p class="form-help">{{T .AdminLang "languages.quick_select_hint"}}</p>
                    <select
                        id="quick_select"
                        class="form-input form-select"
                        @change="selectLanguage($event.target.value)"
                    >
                        <option value="">{{T .AdminLang "languages.select_language"}}</option>
                        {{range .Data.CommonLanguages}}
                        <option value="{{.Code}}|{{.Name}}|{{.NativeName}}|{{.Direction}}">{{.Name}} ({{.Code}})</option>
                        {{end}}
                    </select>
                </div>

                <div class="form-group form-group-full">
                    <hr class="form-divider">
                </div>
                {{end}}

                <div class="form-group">
                    <label for="code" class="form-label">{{T .AdminLang "languages.language_code"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="code"
                        name="code"
                        class="form-input{{if index .Data.Errors "code"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "code"}}"
                        x-model="code"
                        placeholder="{{T .AdminLang "languages.code_placeholder"}}"
                        maxlength="5"
                        required
                        {{if .Data.IsEdit}}readonly{{else}}autofocus{{end}}
                    >
                    {{if index .Data.Errors "code"}}
                    <span class="form-error">{{index .Data.Errors "code"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.code_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="name" class="form-label">{{T .AdminLang "label.name"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        class="form-input{{if index .Data.Errors "name"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "name"}}"
                        x-model="name"
                        placeholder="{{T .AdminLang "languages.name_placeholder"}}"
                        required
                        maxlength="255"
                    >
                    {{if index .Data.Errors "name"}}
                    <span class="form-error">{{index .Data.Errors "name"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.name_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="native_name" class="form-label">{{T .AdminLang "languages.native_name"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="native_name"
                        name="native_name"
                        class="form-input{{if index .Data.Errors "native_name"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "native_name"}}"
                        x-model="nativeName"
                        placeholder="{{T .AdminLang "languages.native_placeholder"}}"
                        required
                        maxlength="255"
                    >
                    {{if index .Data.Errors "native_name"}}
                    <span class="form-error">{{index .Data.Errors "native_name"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.native_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="direction" class="form-label">{{T .AdminLang "languages.text_direction"}} <span class="required">*</span></label>
                    <select
                        id="direction"
                        name="direction"
                        class="form-input form-select{{if index .Data.Errors "direction"}} is-invalid{{end}}"
                        x-model="direction"
                        required
                    >
                        {{$currentDirection := index .Data.FormValues "direction"}}
                        <option value="ltr"{{if or (eq $currentDirection "ltr") (eq $currentDirection "")}} selected{{end}}>{{T .AdminLang "languages.ltr"}}</option>
                        <option value="rtl"{{if eq $currentDirection "rtl"}} selected{{end}}>{{T .AdminLang "languages.rtl"}}</option>
                    </select>
                    {{if index .Data.Errors "direction"}}
                    <span class="form-error">{{index .Data.Errors "direction"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.direction_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="position" class="form-label">{{T .AdminLang "languages.position"}}</label>
                    <input
                        type="number"
                        id="position"
                        name="position"
                        class="form-input{{if index .Data.Errors "position"}} is-invalid{{end}}"
                        value="{{index .Data.FormValues "position"}}"
                        placeholder="0"
                        min="0"
                    >
                    {{if index .Data.Errors "position"}}
                    <span class="form-error">{{index .Data.Errors "position"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.position_hint"}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label class="form-label">{{T .AdminLang "label.status"}}</label>
                    <div class="form-check">
                        <input
                            type="checkbox"
                            id="is_active"
                            name="is_active"
                            value="1"
                            class="form-check-input"
                            {{if or (eq (index .Data.FormValues "is_active") "1") (not .Data.IsEdit)}}checked{{end}}
                        >
                        <label for="is_active" class="form-check-label">{{T .AdminLang "label.active"}}</label>
                    </div>
                    {{if index .Data.Errors "is_active"}}
                    <span class="form-error">{{index .Data.Errors "is_active"}}</span>
                    {{else}}
                    <span class="form-hint">{{T .AdminLang "languages.status_hint"}}</span>
                    {{end}}
                </div>
            </div>

            {{if .Data.IsEdit}}
            {{if .Data.Language.IsDefault}}
            <div class="form-group form-group-full">
                <div class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    <span>{{T .AdminLang "languages.is_default_info"}}</span>
                </div>
            </div>
            {{end}}
            {{end}}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    {{if .Data.IsEdit}}{{T .AdminLang "languages.update"}}{{else}}{{T .AdminLang "languages.create"}}{{end}}
                </button>
                <a href="/admin/languages" class="btn btn-outline">{{T .AdminLang "btn.cancel"}}</a>
            </div>
        </form>
    </div>
</div>

<script>
function languageForm() {
    return {
        code: '{{index .Data.FormValues "code"}}',
        name: '{{index .Data.FormValues "name"}}',
        nativeName: '{{index .Data.FormValues "native_name"}}',
        direction: '{{if index .Data.FormValues "direction"}}{{index .Data.FormValues "direction"}}{{else}}ltr{{end}}',

        selectLanguage(value) {
            if (!value) return;
            const parts = value.split('|');
            if (parts.length >= 4) {
                this.code = parts[0];
                this.name = parts[1];
                this.nativeName = parts[2];
                this.direction = parts[3];
            }
        }
    }
}
</script>
{{end}}
