{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{T .AdminLang "media.edit_title"}}</h1>
        <p class="page-description">{{T .AdminLang "media.edit_description"}}</p>
    </div>
    <div class="page-actions">
        <a href="/admin/media" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            {{T .AdminLang "media.back_to_library"}}
        </a>
    </div>
</div>

<div class="media-edit-layout">
    <!-- Preview Panel -->
    <div class="card media-preview-panel">
        <div class="media-preview-container">
            {{if .Data.Media.IsImage}}
            <img src="{{.Data.Media.OriginalURL}}" alt="{{.Data.Media.Alt.String}}" class="media-preview-image">
            {{else}}
            <div class="media-preview-icon">
                {{if eq .Data.Media.TypeIcon "video"}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"/><rect x="2" y="6" width="14" height="12" rx="2"/></svg>
                {{else if eq .Data.Media.TypeIcon "file-text"}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                {{else}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>
                {{end}}
            </div>
            {{end}}
        </div>

        <div class="media-details">
            <div class="media-detail-row">
                <span class="media-detail-label">{{T .AdminLang "media.type"}}</span>
                <span class="media-detail-value">{{.Data.Media.MimeType}}</span>
            </div>
            <div class="media-detail-row">
                <span class="media-detail-label">{{T .AdminLang "label.size"}}</span>
                <span class="media-detail-value">{{formatBytes .Data.Media.Size}}</span>
            </div>
            {{if .Data.Media.Width.Valid}}
            <div class="media-detail-row">
                <span class="media-detail-label">{{T .AdminLang "media.dimensions"}}</span>
                <span class="media-detail-value">{{.Data.Media.Width.Int64}} x {{.Data.Media.Height.Int64}} px</span>
            </div>
            {{end}}
            <div class="media-detail-row">
                <span class="media-detail-label">{{T .AdminLang "media.uploaded"}}</span>
                <span class="media-detail-value">{{formatDateTime .Data.Media.CreatedAt}}</span>
            </div>
            <div class="media-detail-row">
                <span class="media-detail-label">UUID</span>
                <span class="media-detail-value"><code class="slug-code">{{.Data.Media.Uuid}}</code></span>
            </div>
        </div>

        {{if .Data.Variants}}
        <div class="media-variants">
            <h4>{{T .AdminLang "media.available_sizes"}}</h4>
            <ul class="variant-list">
                {{range .Data.Variants}}
                <li>
                    <span class="variant-type">{{if eq .Type "thumbnail"}}{{T $.AdminLang "media.variant_thumbnail"}}{{else if eq .Type "medium"}}{{T $.AdminLang "media.variant_medium"}}{{else if eq .Type "large"}}{{T $.AdminLang "media.variant_large"}}{{else}}{{.Type}}{{end}}</span>
                    <span class="variant-size">{{.Width}}x{{.Height}}</span>
                    <span class="variant-filesize">{{formatBytes .Size}}</span>
                </li>
                {{end}}
            </ul>
        </div>
        {{end}}

        <div class="media-actions-panel">
            <a href="{{.Data.Media.OriginalURL}}" class="btn btn-outline btn-block" download>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                {{T .AdminLang "media.download_original"}}
            </a>
            <button
                type="button"
                class="btn btn-outline btn-block"
                onclick="copyToClipboard('{{.Data.Media.OriginalURL}}')"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                {{T .AdminLang "media.copy_url"}}
            </button>
            {{if .Data.Media.IsImage}}
            <form action="/admin/media/{{.Data.Media.ID}}/regenerate" method="POST" class="btn-form">
                {{.CSRFField}}
                <button type="submit" class="btn btn-outline btn-block">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
                    {{T .AdminLang "media.regenerate_variants"}}
                </button>
            </form>
            {{end}}
        </div>
    </div>

    <!-- Edit Form Panel -->
    <div class="card media-form-panel">
        <div class="card-body">
            <form action="/admin/media/{{.Data.Media.ID}}" method="POST">
                {{.CSRFField}}
                <input type="hidden" name="_method" value="PUT">

                <div class="form-group">
                    <label for="filename" class="form-label">{{T .AdminLang "media.filename"}} <span class="required">*</span></label>
                    <input
                        type="text"
                        id="filename"
                        name="filename"
                        value="{{if .Data.FormValues.filename}}{{.Data.FormValues.filename}}{{else}}{{.Data.Media.Filename}}{{end}}"
                        class="form-input {{if .Data.Errors.filename}}is-invalid{{end}}"
                        required
                    >
                    {{if .Data.Errors.filename}}
                    <span class="form-error">{{.Data.Errors.filename}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="alt" class="form-label">{{T .AdminLang "media.alt_text"}}</label>
                    <input
                        type="text"
                        id="alt"
                        name="alt"
                        value="{{if .Data.FormValues.alt}}{{.Data.FormValues.alt}}{{else}}{{.Data.Media.Alt.String}}{{end}}"
                        class="form-input"
                        placeholder="{{T .AdminLang "media.alt_placeholder"}}"
                    >
                    <span class="form-hint">{{T .AdminLang "media.alt_hint"}}</span>
                </div>

                <div class="form-group">
                    <label for="caption" class="form-label">{{T .AdminLang "media.caption"}}</label>
                    <textarea
                        id="caption"
                        name="caption"
                        class="form-input"
                        rows="3"
                        placeholder="{{T .AdminLang "media.caption_placeholder"}}"
                    >{{if .Data.FormValues.caption}}{{.Data.FormValues.caption}}{{else}}{{.Data.Media.Caption.String}}{{end}}</textarea>
                </div>

                {{if .Data.Languages}}
                <!-- Translations Section -->
                <div class="translations-section">
                    <h4 class="section-title">{{T .AdminLang "media.translations"}}</h4>
                    {{range .Data.Languages}}
                    {{$trans := index $.Data.Translations .Code}}
                    <fieldset class="translation-fieldset">
                        <legend class="translation-legend">{{.NativeName}} ({{.Code}})</legend>
                        <div class="form-group">
                            <label for="alt_{{.Code}}" class="form-label">{{T $.AdminLang "media.alt_text"}}</label>
                            <input
                                type="text"
                                id="alt_{{.Code}}"
                                name="alt_{{.Code}}"
                                value="{{if $trans}}{{$trans.Alt}}{{end}}"
                                class="form-input"
                                placeholder="{{T $.AdminLang "media.alt_placeholder"}}"
                            >
                        </div>
                        <div class="form-group">
                            <label for="caption_{{.Code}}" class="form-label">{{T $.AdminLang "media.caption"}}</label>
                            <textarea
                                id="caption_{{.Code}}"
                                name="caption_{{.Code}}"
                                class="form-input"
                                rows="2"
                                placeholder="{{T $.AdminLang "media.caption_placeholder"}}"
                            >{{if $trans}}{{$trans.Caption}}{{end}}</textarea>
                        </div>
                    </fieldset>
                    {{end}}
                </div>
                {{end}}

                {{if .Data.Folders}}
                <div class="form-group">
                    <label for="folder_id" class="form-label">{{T .AdminLang "media.folder"}}</label>
                    <select id="folder_id" name="folder_id" class="form-select">
                        <option value="">{{T .AdminLang "media.no_folder"}}</option>
                        {{$currentFolder := .Data.Media.FolderID}}
                        {{range .Data.Folders}}
                        <option value="{{.ID}}" {{if and $currentFolder.Valid (eq $currentFolder.Int64 .ID)}}selected{{end}}>
                            {{.Name}}
                        </option>
                        {{end}}
                    </select>
                </div>
                {{end}}

                <div class="form-actions">
                    <a href="/admin/media" class="btn btn-outline">{{T .AdminLang "btn.cancel"}}</a>
                    <button type="submit" class="btn btn-primary">{{T .AdminLang "media.save_changes"}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Section -->
<div class="card danger-zone" x-data="{ showConfirm: false }">
    <div class="card-body">
        <h3 class="danger-title">{{T .AdminLang "media.danger_zone"}}</h3>
        <p class="danger-description">{{T .AdminLang "media.danger_description"}}</p>
        <button
            type="button"
            class="btn btn-danger"
            @click="showConfirm = true"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            {{T .AdminLang "media.delete_media"}}
        </button>

        <!-- Delete Confirmation Modal -->
        <div
            class="modal-overlay"
            x-show="showConfirm"
            x-cloak
            @click.self="showConfirm = false"
            x-transition:enter="modal-enter"
            x-transition:leave="modal-leave"
        >
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3 class="modal-title">{{T .AdminLang "media.delete_media"}}</h3>
                    <button type="button" class="modal-close" @click="showConfirm = false" aria-label="{{T .AdminLang "btn.close"}}">&times;</button>
                </div>
                <div class="modal-body">
                    <p>{{T .AdminLang "media.confirm_delete_name"}} <strong>{{.Data.Media.Filename}}</strong>?</p>
                    <p class="text-muted">{{T .AdminLang "media.delete_warning"}}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" @click="showConfirm = false">{{T .AdminLang "btn.cancel"}}</button>
                    <form action="/admin/media/{{.Data.Media.ID}}" method="POST" class="inline-form">
                        {{.CSRFField}}
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-danger">
                            {{T .AdminLang "media.delete_media"}}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(window.location.origin + text).then(function() {
        alert('{{T .AdminLang "media.url_copied"}}');
    }, function() {
        alert('{{T .AdminLang "media.url_copy_failed"}}');
    });
}
</script>
{{end}}
