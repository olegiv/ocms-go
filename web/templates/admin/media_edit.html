{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">Edit Media</h1>
        <p class="page-description">Update media metadata</p>
    </div>
    <div class="page-actions">
        <a href="/admin/media" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Back to Library
        </a>
    </div>
</div>

<div class="media-edit-layout">
    <!-- Preview Panel -->
    <div class="card media-preview-panel">
        <div class="media-preview-container">
            {{if .Data.Media.IsImage}}
            <img src="{{.Data.Media.OriginalURL}}" alt="{{.Data.Media.Alt.String}}" class="media-preview-image">
            {{else}}
            <div class="media-preview-icon">
                {{if eq .Data.Media.TypeIcon "video"}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"/><rect x="2" y="6" width="14" height="12" rx="2"/></svg>
                {{else if eq .Data.Media.TypeIcon "file-text"}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                {{else}}
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>
                {{end}}
            </div>
            {{end}}
        </div>

        <div class="media-details">
            <div class="media-detail-row">
                <span class="media-detail-label">Type</span>
                <span class="media-detail-value">{{.Data.Media.MimeType}}</span>
            </div>
            <div class="media-detail-row">
                <span class="media-detail-label">Size</span>
                <span class="media-detail-value">{{formatBytes .Data.Media.Size}}</span>
            </div>
            {{if .Data.Media.Width.Valid}}
            <div class="media-detail-row">
                <span class="media-detail-label">Dimensions</span>
                <span class="media-detail-value">{{.Data.Media.Width.Int64}} x {{.Data.Media.Height.Int64}} px</span>
            </div>
            {{end}}
            <div class="media-detail-row">
                <span class="media-detail-label">Uploaded</span>
                <span class="media-detail-value">{{formatDateTime .Data.Media.CreatedAt}}</span>
            </div>
            <div class="media-detail-row">
                <span class="media-detail-label">UUID</span>
                <span class="media-detail-value"><code class="slug-code">{{.Data.Media.Uuid}}</code></span>
            </div>
        </div>

        {{if .Data.Variants}}
        <div class="media-variants">
            <h4>Available Sizes</h4>
            <ul class="variant-list">
                {{range .Data.Variants}}
                <li>
                    <span class="variant-type">{{.Type}}</span>
                    <span class="variant-size">{{.Width}}x{{.Height}}</span>
                    <span class="variant-filesize">{{formatBytes .Size}}</span>
                </li>
                {{end}}
            </ul>
        </div>
        {{end}}

        <div class="media-actions-panel">
            <a href="{{.Data.Media.OriginalURL}}" class="btn btn-outline btn-block" download>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                Download Original
            </a>
            <button
                type="button"
                class="btn btn-outline btn-block"
                onclick="copyToClipboard('{{.Data.Media.OriginalURL}}')"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                Copy URL
            </button>
        </div>
    </div>

    <!-- Edit Form Panel -->
    <div class="card media-form-panel">
        <div class="card-body">
            <form action="/admin/media/{{.Data.Media.ID}}" method="POST">
                <input type="hidden" name="_method" value="PUT">

                <div class="form-group">
                    <label for="filename" class="form-label">Filename <span class="required">*</span></label>
                    <input
                        type="text"
                        id="filename"
                        name="filename"
                        value="{{if .Data.FormValues.filename}}{{.Data.FormValues.filename}}{{else}}{{.Data.Media.Filename}}{{end}}"
                        class="form-input {{if .Data.Errors.filename}}is-invalid{{end}}"
                        required
                    >
                    {{if .Data.Errors.filename}}
                    <span class="form-error">{{.Data.Errors.filename}}</span>
                    {{end}}
                </div>

                <div class="form-group">
                    <label for="alt" class="form-label">Alt Text</label>
                    <input
                        type="text"
                        id="alt"
                        name="alt"
                        value="{{if .Data.FormValues.alt}}{{.Data.FormValues.alt}}{{else}}{{.Data.Media.Alt.String}}{{end}}"
                        class="form-input"
                        placeholder="Describe this image for accessibility"
                    >
                    <span class="form-hint">Used for screen readers and when the image cannot be displayed</span>
                </div>

                <div class="form-group">
                    <label for="caption" class="form-label">Caption</label>
                    <textarea
                        id="caption"
                        name="caption"
                        class="form-input"
                        rows="3"
                        placeholder="Optional caption for this media"
                    >{{if .Data.FormValues.caption}}{{.Data.FormValues.caption}}{{else}}{{.Data.Media.Caption.String}}{{end}}</textarea>
                </div>

                {{if .Data.Folders}}
                <div class="form-group">
                    <label for="folder_id" class="form-label">Folder</label>
                    <select id="folder_id" name="folder_id" class="form-select">
                        <option value="">No folder</option>
                        {{$currentFolder := .Data.Media.FolderID}}
                        {{range .Data.Folders}}
                        <option value="{{.ID}}" {{if and $currentFolder.Valid (eq $currentFolder.Int64 .ID)}}selected{{end}}>
                            {{.Name}}
                        </option>
                        {{end}}
                    </select>
                </div>
                {{end}}

                <div class="form-actions">
                    <a href="/admin/media" class="btn btn-outline">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Section -->
<div class="card danger-zone" x-data="{ showConfirm: false }">
    <div class="card-body">
        <h3 class="danger-title">Danger Zone</h3>
        <p class="danger-description">Once you delete this media, there is no going back. The file and all its variants will be permanently removed.</p>
        <button
            type="button"
            class="btn btn-danger"
            @click="showConfirm = true"
        >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            Delete Media
        </button>

        <!-- Delete Confirmation Modal -->
        <div
            class="modal-overlay"
            x-show="showConfirm"
            x-cloak
            @click.self="showConfirm = false"
            x-transition:enter="modal-enter"
            x-transition:leave="modal-leave"
        >
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3 class="modal-title">Delete Media</h3>
                    <button type="button" class="modal-close" @click="showConfirm = false">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete <strong>{{.Data.Media.Filename}}</strong>?</p>
                    <p class="text-muted">This action cannot be undone. The file and all its variants will be permanently removed.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" @click="showConfirm = false">Cancel</button>
                    <form action="/admin/media/{{.Data.Media.ID}}" method="POST" class="inline-form">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-danger">
                            Delete Media
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(window.location.origin + text).then(function() {
        alert('URL copied to clipboard!');
    }, function() {
        alert('Failed to copy URL');
    });
}
</script>
{{end}}
