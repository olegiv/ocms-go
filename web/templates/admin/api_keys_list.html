{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">{{T .AdminLang "api_keys.title"}}</h1>
        <p class="page-description">{{T .AdminLang "api_keys.description"}} ({{.Data.TotalKeys}} {{T .AdminLang "label.total"}})</p>
    </div>
    <div class="page-actions">
        <a href="/admin/api-keys/new" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
            {{T .AdminLang "api_keys.create"}}
        </a>
    </div>
</div>

{{if .Data.APIKeys}}
<div class="card" id="api-keys-table">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>{{T .AdminLang "label.name"}}</th>
                    <th>{{T .AdminLang "api_keys.key_prefix"}}</th>
                    <th>{{T .AdminLang "api_keys.permissions"}}</th>
                    <th>{{T .AdminLang "label.status"}}</th>
                    <th>{{T .AdminLang "api_keys.last_used"}}</th>
                    <th>{{T .AdminLang "api_keys.expires"}}</th>
                    <th class="text-right">{{T .AdminLang "label.actions"}}</th>
                </tr>
            </thead>
            <tbody>
                {{range .Data.APIKeys}}
                <tr id="api-key-row-{{.ID}}">
                    <td>
                        <strong>{{.Name}}</strong>
                    </td>
                    <td>
                        <code class="key-prefix">{{.KeyPrefix}}...</code>
                    </td>
                    <td>
                        <div class="permission-badges">
                            {{$perms := parseJSON .Permissions}}
                            {{range $perms}}
                            <span class="badge badge-outline badge-sm">{{.}}</span>
                            {{end}}
                            {{if not $perms}}
                            <span class="text-muted">{{T $.AdminLang "api_keys.none"}}</span>
                            {{end}}
                        </div>
                    </td>
                    <td>
                        {{if .IsActive}}
                            {{if and .ExpiresAt.Valid (lt .ExpiresAt.Time now)}}
                            <span class="badge badge-warning">{{T $.AdminLang "api_keys.expired"}}</span>
                            {{else}}
                            <span class="badge badge-success">{{T $.AdminLang "label.active"}}</span>
                            {{end}}
                        {{else}}
                        <span class="badge badge-secondary">{{T $.AdminLang "api_keys.revoked"}}</span>
                        {{end}}
                    </td>
                    <td>
                        {{if .LastUsedAt.Valid}}
                            {{formatDateTime .LastUsedAt.Time}}
                        {{else}}
                            <span class="text-muted">{{T $.AdminLang "label.never"}}</span>
                        {{end}}
                    </td>
                    <td>
                        {{if .ExpiresAt.Valid}}
                            {{formatDate .ExpiresAt.Time}}
                        {{else}}
                            <span class="text-muted">{{T $.AdminLang "label.never"}}</span>
                        {{end}}
                    </td>
                    <td class="text-right">
                        <div class="action-buttons">
                            <a href="/admin/api-keys/{{.ID}}" class="btn btn-sm btn-outline" title="{{T $.AdminLang "btn.edit"}}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                            </a>
                            {{if .IsActive}}
                            <div x-data="{ showConfirm: false }" class="delete-action">
                                <button
                                    type="button"
                                    class="btn btn-sm btn-danger"
                                    title="{{T $.AdminLang "api_keys.revoke"}}"
                                    @click="showConfirm = true"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" x2="19.07" y1="4.93" y2="19.07"/></svg>
                                </button>

                                <!-- Revoke Confirmation Modal -->
                                <div
                                    class="modal-overlay"
                                    x-show="showConfirm"
                                    x-cloak
                                    @click.self="showConfirm = false"
                                    x-transition:enter="modal-enter"
                                    x-transition:leave="modal-leave"
                                >
                                    <div class="modal" @click.stop>
                                        <div class="modal-header">
                                            <h3 class="modal-title">{{T $.AdminLang "api_keys.revoke_key"}}</h3>
                                            <button type="button" class="modal-close" @click="showConfirm = false" aria-label="{{T $.AdminLang "btn.close"}}">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            <p>{{T $.AdminLang "api_keys.confirm_revoke"}} <strong>{{.Name}}</strong>?</p>
                                            <p class="text-muted">{{T $.AdminLang "api_keys.revoke_warning"}}</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-outline" @click="showConfirm = false">{{T $.AdminLang "btn.cancel"}}</button>
                                            <button
                                                type="button"
                                                class="btn btn-danger"
                                                hx-delete="/admin/api-keys/{{.ID}}"
                                                hx-target="#api-key-row-{{.ID}}"
                                                hx-swap="outerHTML"
                                                @click="showConfirm = false"
                                            >
                                                {{T $.AdminLang "api_keys.revoke_key"}}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>

    {{if .Data.Pagination.ShouldShow}}
    <div class="card-footer">
        {{template "pagination" (dict "Pagination" .Data.Pagination "AdminLang" .AdminLang)}}
    </div>
    {{end}}
</div>
{{else}}
<div class="card">
    <div class="card-body">
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
            <p>{{T .AdminLang "api_keys.no_keys"}}</p>
            <span class="empty-hint">{{T .AdminLang "api_keys.no_keys_hint"}}</span>
            <div class="empty-state-action">
                <a href="/admin/api-keys/new" class="btn btn-primary">{{T .AdminLang "api_keys.create"}}</a>
            </div>
        </div>
    </div>
</div>
{{end}}

<div class="card mt-6">
    <div class="card-header">
        <h3 class="card-title">{{T .AdminLang "api_keys.usage"}}</h3>
    </div>
    <div class="card-body">
        <p>{{T .AdminLang "api_keys.usage_hint"}}</p>
        <pre class="code-block"><code>Authorization: Bearer YOUR_API_KEY</code></pre>
        <p class="mt-4">{{T .AdminLang "api_keys.base_url"}}: <code>/api/v1/</code></p>
        <p class="tags-wrapper">
            <a href="/api/v1/status" target="_blank" class="btn btn-sm btn-outline">{{T .AdminLang "api_keys.check_status"}}</a>
            <a href="/api/v1/docs" target="_blank" class="btn btn-sm btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                {{T .AdminLang "api_keys.view_docs"}}
            </a>
        </p>
    </div>
</div>
{{end}}
