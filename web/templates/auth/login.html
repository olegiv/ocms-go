{{define "body"}}
<div class="auth-container">
    {{$langOptions := adminLangOptions}}
    {{if gt (len $langOptions) 1}}
    <form action="/language" method="POST" class="auth-lang-form">
        {{.CSRFField}}
        <label class="auth-lang-selector" title="{{T .AdminLang "admin.change_language"}}">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            <select name="lang" onchange="this.form.submit()" class="auth-lang-select" aria-label="{{T .AdminLang "admin.change_language"}}">
                {{range $langOptions}}
                <option value="{{.Code}}"{{if eq .Code $.AdminLang}} selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </label>
    </form>
    {{end}}
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">oCMS</h1>
            <p class="auth-subtitle">{{T .AdminLang "auth.login_title"}}</p>
        </div>

        {{template "alert" .}}

        <form method="POST" action="/login" class="auth-form">
            {{.CSRFField}}
            <div class="form-group">
                <label for="email" class="form-label">{{T .AdminLang "label.email"}}</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    class="form-input"
                    placeholder="admin@example.com"
                    required
                    autofocus
                    data-msg-required="{{T .AdminLang "validation.required"}}"
                    data-msg-email="{{T .AdminLang "validation.email_invalid"}}"
                >
            </div>

            <div class="form-group">
                <label for="password" class="form-label">{{T .AdminLang "label.password"}}</label>
                <input
                    type="password"
                    id="password"
                    name="password"
                    class="form-input"
                    placeholder="{{T .AdminLang "auth.password_placeholder"}}"
                    required
                    data-msg-required="{{T .AdminLang "validation.required"}}"
                >
            </div>

            {{if hcaptchaEnabled}}
            <div class="form-group captcha-group">
                {{hcaptchaWidget}}
            </div>
            {{end}}

            <button type="submit" class="btn btn-primary btn-block">
                {{T .AdminLang "auth.login"}}
            </button>
        </form>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input[required]');
    inputs.forEach(function(input) {
        input.addEventListener('invalid', function(e) {
            e.preventDefault();
            if (input.validity.valueMissing) {
                input.setCustomValidity(input.dataset.msgRequired || '');
            } else if (input.validity.typeMismatch && input.type === 'email') {
                input.setCustomValidity(input.dataset.msgEmail || '');
            }
            input.reportValidity();
        });
        input.addEventListener('input', function() {
            input.setCustomValidity('');
        });
    });

    // Fix hCaptcha iframe height to show test mode warning text properly
    // hCaptcha sets inline height of 76px which clips the warning message
    function fixHCaptchaHeight() {
        const iframe = document.querySelector('.h-captcha iframe');
        if (iframe && iframe.offsetHeight < 115) {
            iframe.style.setProperty('height', '115px', 'important');
            iframe.style.setProperty('min-height', '115px', 'important');
        }
    }
    // Poll until hCaptcha is loaded and fixed (hCaptcha loads async)
    let hcaptchaAttempts = 0;
    const hcaptchaInterval = setInterval(function() {
        fixHCaptchaHeight();
        if (++hcaptchaAttempts > 50) clearInterval(hcaptchaInterval);
    }, 100);
});
</script>
{{end}}
