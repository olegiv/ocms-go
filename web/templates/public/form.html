{{define "content"}}
<div class="public-form-container">
    <div class="form-card">
        {{if .Data.Success}}
        <div class="success-message">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <h2>Thank you!</h2>
            <p>{{if .Data.Form.SuccessMessage.Valid}}{{.Data.Form.SuccessMessage.String}}{{else}}Thank you for your submission.{{end}}</p>
            <a href="/forms/{{.Data.Form.Slug}}" class="btn btn-primary">Submit Another Response</a>
        </div>
        {{else}}
        <div class="form-header">
            <h1>{{.Data.Form.Title}}</h1>
            {{if .Data.Form.Description.Valid}}
            {{if .Data.Form.Description.String}}
            <p class="form-description">{{.Data.Form.Description.String}}</p>
            {{end}}
            {{end}}
        </div>

        {{if index .Data.Errors "_form"}}
        <div class="alert alert-error">
            {{index .Data.Errors "_form"}}
        </div>
        {{end}}

        <form method="POST" action="/forms/{{.Data.Form.Slug}}" class="public-form">
            {{.CSRFField}}

            <!-- Honeypot field (hidden from real users, bots will fill it) -->
            <div class="sr-only">
                <label for="_website">Leave this field empty</label>
                <input type="text" name="_website" id="_website" tabindex="-1" autocomplete="off">
            </div>

            {{range .Data.Fields}}
            <div class="form-group{{if index $.Data.Errors .Name}} has-error{{end}}">
                <label for="field_{{.ID}}">
                    {{.Label}}
                    {{if .IsRequired}}<span class="required">*</span>{{end}}
                </label>

                {{if eq .Type "text"}}
                <input type="text"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "email"}}
                <input type="email"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "textarea"}}
                <textarea id="field_{{.ID}}"
                          name="{{.Name}}"
                          {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                          {{if .IsRequired}}required{{end}}
                          rows="5"
                          class="form-control">{{index $.Data.Values .Name}}</textarea>

                {{else if eq .Type "number"}}
                <input type="number"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "date"}}
                <input type="date"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "select"}}
                <select id="field_{{.ID}}"
                        name="{{.Name}}"
                        {{if .IsRequired}}required{{end}}
                        class="form-control">
                    <option value="">-- Select --</option>
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{range $options}}
                    <option value="{{.}}" {{if eq . $selectedValue}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>

                {{else if eq .Type "radio"}}
                <div class="radio-group">
                    {{$fieldName := .Name}}
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{$fieldID := .ID}}
                    {{range $i, $opt := $options}}
                    <label class="radio-label">
                        <input type="radio"
                               name="{{$fieldName}}"
                               value="{{$opt}}"
                               {{if eq $opt $selectedValue}}checked{{end}}>
                        <span>{{$opt}}</span>
                    </label>
                    {{end}}
                </div>

                {{else if eq .Type "checkbox"}}
                <div class="checkbox-group">
                    {{$fieldName := .Name}}
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{$fieldID := .ID}}
                    {{range $i, $opt := $options}}
                    <label class="checkbox-label">
                        <input type="checkbox"
                               name="{{$fieldName}}"
                               value="{{$opt}}"
                               {{if contains $selectedValue $opt}}checked{{end}}>
                        <span>{{$opt}}</span>
                    </label>
                    {{end}}
                </div>

                {{else if eq .Type "file"}}
                <input type="file"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else}}
                <!-- Fallback to text input -->
                <input type="text"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">
                {{end}}

                {{if .HelpText.Valid}}
                {{if .HelpText.String}}
                <small class="help-text">{{.HelpText.String}}</small>
                {{end}}
                {{end}}

                {{if index $.Data.Errors .Name}}
                <div class="form-error">{{index $.Data.Errors .Name}}</div>
                {{end}}
            </div>
            {{end}}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </div>
        </form>
        {{end}}
    </div>
</div>
{{end}}

{{define "body"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - {{.Data.SiteName}}</title>
    <link rel="stylesheet" href="/static/dist/main.css">
    
</head>
<body>
    {{template "content" .}}
</body>
</html>
{{end}}
