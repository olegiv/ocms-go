{{define "content"}}
<div class="public-form-container">
    <div class="form-card">
        {{if .Data.Success}}
        <div class="success-message">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <h2>Thank you!</h2>
            <p>{{if .Data.Form.SuccessMessage.Valid}}{{.Data.Form.SuccessMessage.String}}{{else}}Thank you for your submission.{{end}}</p>
            <a href="/forms/{{.Data.Form.Slug}}" class="btn btn-primary">Submit Another Response</a>
        </div>
        {{else}}
        <div class="form-header">
            <h1>{{.Data.Form.Title}}</h1>
            {{if .Data.Form.Description.Valid}}
            {{if .Data.Form.Description.String}}
            <p class="form-description">{{.Data.Form.Description.String}}</p>
            {{end}}
            {{end}}
        </div>

        {{if index .Data.Errors "_form"}}
        <div class="alert alert-error">
            {{index .Data.Errors "_form"}}
        </div>
        {{end}}

        <form method="POST" action="/forms/{{.Data.Form.Slug}}" class="public-form">
            {{.CSRFField}}

            <!-- Honeypot field (hidden from real users, bots will fill it) -->
            <div style="position: absolute; left: -9999px;">
                <label for="_website">Leave this field empty</label>
                <input type="text" name="_website" id="_website" tabindex="-1" autocomplete="off">
            </div>

            {{range .Data.Fields}}
            <div class="form-group{{if index $.Data.Errors .Name}} has-error{{end}}">
                <label for="field_{{.ID}}">
                    {{.Label}}
                    {{if .IsRequired}}<span class="required">*</span>{{end}}
                </label>

                {{if eq .Type "text"}}
                <input type="text"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "email"}}
                <input type="email"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "textarea"}}
                <textarea id="field_{{.ID}}"
                          name="{{.Name}}"
                          {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                          {{if .IsRequired}}required{{end}}
                          rows="5"
                          class="form-control">{{index $.Data.Values .Name}}</textarea>

                {{else if eq .Type "number"}}
                <input type="number"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "date"}}
                <input type="date"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else if eq .Type "select"}}
                <select id="field_{{.ID}}"
                        name="{{.Name}}"
                        {{if .IsRequired}}required{{end}}
                        class="form-control">
                    <option value="">-- Select --</option>
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{range $options}}
                    <option value="{{.}}" {{if eq . $selectedValue}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>

                {{else if eq .Type "radio"}}
                <div class="radio-group">
                    {{$fieldName := .Name}}
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{$fieldID := .ID}}
                    {{range $i, $opt := $options}}
                    <label class="radio-label">
                        <input type="radio"
                               name="{{$fieldName}}"
                               value="{{$opt}}"
                               {{if eq $opt $selectedValue}}checked{{end}}>
                        <span>{{$opt}}</span>
                    </label>
                    {{end}}
                </div>

                {{else if eq .Type "checkbox"}}
                <div class="checkbox-group">
                    {{$fieldName := .Name}}
                    {{$selectedValue := index $.Data.Values .Name}}
                    {{$options := parseJSON .Options.String}}
                    {{$fieldID := .ID}}
                    {{range $i, $opt := $options}}
                    <label class="checkbox-label">
                        <input type="checkbox"
                               name="{{$fieldName}}"
                               value="{{$opt}}"
                               {{if contains $selectedValue $opt}}checked{{end}}>
                        <span>{{$opt}}</span>
                    </label>
                    {{end}}
                </div>

                {{else if eq .Type "file"}}
                <input type="file"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       {{if .IsRequired}}required{{end}}
                       class="form-control">

                {{else}}
                <!-- Fallback to text input -->
                <input type="text"
                       id="field_{{.ID}}"
                       name="{{.Name}}"
                       value="{{index $.Data.Values .Name}}"
                       {{if .Placeholder.Valid}}placeholder="{{.Placeholder.String}}"{{end}}
                       {{if .IsRequired}}required{{end}}
                       class="form-control">
                {{end}}

                {{if .HelpText.Valid}}
                {{if .HelpText.String}}
                <small class="help-text">{{.HelpText.String}}</small>
                {{end}}
                {{end}}

                {{if index $.Data.Errors .Name}}
                <div class="form-error">{{index $.Data.Errors .Name}}</div>
                {{end}}
            </div>
            {{end}}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </div>
        </form>
        {{end}}
    </div>
</div>
{{end}}

{{define "body"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - {{.Data.SiteName}}</title>
    <link rel="stylesheet" href="/static/dist/main.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --error-color: #dc2626;
            --success-color: #16a34a;
            --text-color: #1f2937;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --bg-color: #f9fafb;
            --card-bg: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .public-form-container {
            max-width: 640px;
            margin: 0 auto;
        }

        .form-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            padding: 2rem;
        }

        .form-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .form-description {
            color: var(--text-muted);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .required {
            color: var(--error-color);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: #fff;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .radio-label,
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: normal;
        }

        .radio-label input,
        .checkbox-label input {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary-color);
        }

        .help-text {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .form-error {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--error-color);
        }

        .has-error .form-control {
            border-color: var(--error-color);
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .alert-error {
            background: #fef2f2;
            color: var(--error-color);
            border: 1px solid #fee2e2;
        }

        .form-actions {
            margin-top: 2rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.15s, transform 0.1s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary-color);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.125rem;
            width: 100%;
        }

        /* Success state */
        .success-message {
            text-align: center;
            padding: 2rem 0;
        }

        .success-message svg {
            color: var(--success-color);
            margin-bottom: 1rem;
        }

        .success-message h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .success-message p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .success-message .btn {
            width: auto;
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }

            .form-card {
                padding: 1.5rem;
            }

            .form-header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    {{template "content" .}}
</body>
</html>
{{end}}
